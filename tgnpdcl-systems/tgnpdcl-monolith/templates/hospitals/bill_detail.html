{% extends 'base.html' %}
{% load static %}

{% block title %}Bill Details - {{ bill.bill_number }}{% endblock %}

{% block content %}
<div class="dashboard">
 <aside class="sidebar">
 <div class="sidebar-logo">
 <span class="sidebar-logo-icon">âš¡</span>
 <span class="sidebar-logo-text">TGNPDCL</span>
 </div>
 <nav>
 <ul class="sidebar-nav">
 <li class="sidebar-nav-item">
 <a href="{% url 'dashboard' %}" class="sidebar-nav-link">ğŸ“Š Dashboard</a>
 </li>
 {% if profile.role == 'HOSPITAL' %}
 <li class="sidebar-nav-item">
 <a href="{% url 'hospitals:dashboard' %}" class="sidebar-nav-link">ğŸ¥ Hospital</a>
 </li>
 <li class="sidebar-nav-item">
 <a href="{% url 'hospitals:bill_list' %}" class="sidebar-nav-link active">ğŸ“„ Bills</a>
 </li>
 {% else %}
 <li class="sidebar-nav-item">
 <a href="{% url 'workflow:approval_queue' %}" class="sidebar-nav-link active">âœ… Approval Queue</a>
 </li>
 {% endif %}
 <li class="sidebar-nav-item">
 <a href="{% url 'documents:document_list' %}" class="sidebar-nav-link">ğŸ“ Documents</a>
 </li>
 </ul>
 </nav>
 <div style="position: absolute; bottom: 1.5rem; left: 1.5rem; right: 1.5rem;">
 <a href="{% url 'logout' %}" class="btn btn-secondary btn-block">ğŸšª Logout</a>
 </div>
 </aside>

 <main class="main-content">
 <div class="page-header">
 <h1 class="page-title">Bill: {{ bill.bill_number }}</h1>
 <span class="badge badge-{{ bill.status|lower }}">{{ bill.get_status_display }}</span>
 </div>

 <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
 <!-- Bill Info -->
 <div class="card fade-in">
 <div class="card-header">
 <h3 style="font-size: 1.125rem;">Patient Details</h3>
 </div>
 <div class="card-body">
 <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
 <div>
 <p class="text-muted">Patient Name</p>
 <p style="font-weight: 600;">{{ bill.patient_name }}</p>
 </div>
 <div>
 <p class="text-muted">Scheme</p>
 <p class="badge badge-info">{{ bill.scheme.name|default:"General" }}</p>
 </div>
 <div>
 <p class="text-muted">Admission Date</p>
 <p>{{ bill.admission_date }}</p>
 </div>
 <div>
 <p class="text-muted">Discharge Date</p>
 <p>{{ bill.discharge_date }}</p>
 </div>
 <div>
 <p class="text-muted">Total Amount</p>
 <p style="font-size: 1.5rem; font-weight: 700; color: var(--primary-500);">â‚¹{{ bill.gross_total }}</p>
 </div>
 </div>

 <h3 style="font-size: 1.125rem; margin-top: 2rem; margin-bottom: 1rem;">Line Items</h3>
 <div class="table-responsive">
 <table class="table">
 <thead>
 <tr>
 <th>Service</th>
 <th>Rate</th>
 <th>Qty</th>
 <th>Amount</th>
 </tr>
 </thead>
 <tbody>
 {% for item in bill.items.all %}
 <tr>
 <td>{{ item.service_name }}</td>
 <td>â‚¹{{ item.rate }}</td>
 <td>{{ item.quantity }}</td>
 <td>â‚¹{{ item.amount }}</td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
 </div>
 </div>

 <!-- Documents -->
 <div class="card fade-in" style="animation-delay: 0.1s;">
 <div class="card-header">
 <h3 style="font-size: 1.125rem;">ğŸ“„ Attached Documents (S3)</h3>
 </div>
 <div class="card-body">
 {% if documents %}
 {% for doc in documents %}
 <div class="document-card mb-4">
 <div class="document-name" style="font-size: 0.9rem;">
 {{ doc.get_doc_type_display }}
 {% if doc.service %}
 <br><small class="text-muted">Head: {{ doc.service.name }}</small>
 {% endif %}
 </div>
 <div class="document-meta">{{ doc.original_filename }}</div>
 <div style="margin-top: 0.5rem;">
 <a href="{{ doc.file.url }}" class="btn btn-secondary btn-block" style="font-size: 0.75rem;"
 target="_blank">View File</a>
 </div>
 </div>
 {% endfor %}
 {% else %}
 <p class="text-muted text-center">No documents attached.</p>
 {% endif %}
 </div>
 </div>
 </div>
 </main>
</div>
{% endblock %}